<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gas Detector Control</title>
  <script>
    const authToken = "2aroxWWyv1HW9nqksUOzkZIJh9wuiw0L"; // Ganti dengan Blynk Auth Token Anda
    const apiUrl = "https://blynk.cloud/external/api";

    // Elemen DOM untuk kontrol buzzer
    const gasStatus = document.getElementById('gas-status');
    const buzzerSwitch = document.getElementById('buzzer-switch');
    const buzzerOffButton = document.getElementById('buzzer-off-button'); // Tombol untuk mematikan buzzer

    // Update status gas dan buzzer dari Blynk
    function updateGasStatus() {
        fetch(`${apiUrl}/get?token=${authToken}&V1`)
            .then(response => response.text())
            .then(data => {
                gasStatus.textContent = data; // AMAN/WASPADA/BAHAYA
            })
            .catch(error => console.error("Error fetching gas status:", error));

        fetch(`${apiUrl}/get?token=${authToken}&V3`)
            .then(response => response.text())
            .then(data => {
                buzzerSwitch.checked = data === "1"; // ON jika 1
            })
            .catch(error => console.error("Error fetching buzzer status:", error));
    }

    // Event listener untuk switch buzzer
    buzzerSwitch.addEventListener('change', () => {
        const switchState = buzzerSwitch.checked ? 1 : 0;
        fetch(`${apiUrl}/update?token=${authToken}&V3=${switchState}`)
            .then(() => {
                console.log(`Buzzer state updated to: ${switchState}`);
            })
            .catch(error => console.error("Error updating buzzer state:", error));
    });

    // Event listener untuk tombol mematikan buzzer
    buzzerOffButton.addEventListener('click', () => {
        fetch(`${apiUrl}/update?token=${authToken}&V3=0`)
            .then(() => {
                console.log("Buzzer turned off manually.");
                buzzerSwitch.checked = false; // Pastikan switch diperbarui
            })
            .catch(error => console.error("Error turning off buzzer:", error));
    });

    // Perbarui status saat halaman dimuat
    function updateAllStatus() {
        updateGasStatus();
    }

    updateAllStatus();
    setInterval(updateAllStatus, 5000); // Perbarui status setiap 5 detik
</script>


</body>
</html>
